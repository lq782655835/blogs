(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{568:function(t,s,a){"use strict";a.r(s);var n=a(9),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"http跨域解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http跨域解决方案"}},[t._v("#")]),t._v(" HTTP跨域解决方案")]),t._v(" "),a("p",[t._v("浏览器同源策略导致不能加载执行其他网站的脚本，这是互联网安全的一部分。"),a("strong",[t._v("跨域之后ajax请求可以发出，但浏览器在接收前会对其来源进行检查")]),t._v("，如果是不跨域，直接加载数据；如果跨域，会出现著名的"),a("code",[t._v("No 'Access-Control-Allow-Origin' header is present on the requested resource")]),t._v("。以下总结一些常用的HTTP跨域解决方案。")]),t._v(" "),a("blockquote",[a("p",[t._v("常见的跨域都需要后端支持，跨域记得带上http头信息Access-Control-Allow-Origin")])]),t._v(" "),a("blockquote",[a("p",[t._v("跨域拦截，并不一定是浏览器限制了发起跨站请求，也可能是跨站请求可以正常发起，但是返回结果被浏览器拦截了。")])]),t._v(" "),a("h2",{attrs:{id:"jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp"}},[t._v("#")]),t._v(" JSONP")]),t._v(" "),a("p",[t._v("利用浏览器script标签不跨域特点，使用get请求到目标api，再通过目标api返回callbackName(data)方式执行js代码。特点：")]),t._v(" "),a("ol",[a("li",[t._v("只能是get请求")]),t._v(" "),a("li",[t._v("需要后端配合，因为需要知道前端callbackName命名")]),t._v(" "),a("li",[t._v("支持老式浏览器")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'script'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/javascript'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传参并指定回调执行函数为onBack")]),t._v("\nscript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.domain2.com:8080/login?user=admin&callback=onBack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 回调执行函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务端api返回")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors"}},[t._v("#")]),t._v(" CORS")]),t._v(" "),a("p",[t._v("跨域资源共享(Cross-origin resource sharing) 是一种机制，它"),a("code",[t._v("使用额外的 HTTP 头")]),t._v("来告诉浏览器  让运行在一个 origin 上的Web应用被准许访问来自不同源服务器上的指定的资源。特点：")]),t._v(" "),a("ol",[a("li",[t._v("W3C标准")]),t._v(" "),a("li",[t._v("需要浏览器和服务器同时支持，包括增加额外的Http头")])]),t._v(" "),a("h3",{attrs:{id:"cors简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors简单请求"}},[t._v("#")]),t._v(" CORS简单请求")]),t._v(" "),a("ul",[a("li",[t._v("请求方法：三种方法之一\n"),a("ul",[a("li",[t._v("HEAD")]),t._v(" "),a("li",[t._v("GET")]),t._v(" "),a("li",[t._v("POST")])])]),t._v(" "),a("li",[t._v("HTTP头信息：不超出以下几种字段\n"),a("ul",[a("li",[t._v("Accept")]),t._v(" "),a("li",[t._v("Accept-Language")]),t._v(" "),a("li",[t._v("Content-Language")]),t._v(" "),a("li",[t._v("Last-Event-ID")]),t._v(" "),a("li",[t._v("Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain")])])])]),t._v(" "),a("p",[t._v("在头信息之中，增加一个"),a("code",[t._v("Origin字段")]),t._v("。说明本次请求来自哪个域（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求，响应返回"),a("code",[t._v("Access-Control-Allow-Origin字段")]),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("正式请求/响应\n"),a("ul",[a("li",[t._v("请求："),a("code",[t._v("Origin")]),a("sup",[t._v("通用")])]),t._v(" "),a("li",[t._v("响应："),a("code",[t._v("Access-Control-Allow-Origin")]),a("sup",[t._v("通用")]),t._v("。如果是需要发送附带身份凭证（如cookies）的请求(前端代码需要设置：xhr.withCredentials=true)\n"),a("ul",[a("li",[a("code",[t._v("Access-Control-Allow-Credentials")]),t._v("：服务器响应需要设置该字段为true，浏览器才会把内容给请求的发送者。")])])])])])]),t._v(" "),a("blockquote",[a("p",[t._v("为安全性考虑，当响应返回Access-Control-Allow-Credentials：true时，Access-Control-Allow-Origin必须指定具体的Origin，而不是通配符“*”")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://mdn.mozillademos.org/files/14293/simple_req.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"cors非简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors非简单请求"}},[t._v("#")]),t._v(" CORS非简单请求")]),t._v(" "),a("ul",[a("li",[t._v("请求方法\n"),a("ul",[a("li",[t._v("PUT")]),t._v(" "),a("li",[t._v("DELETE")])])]),t._v(" "),a("li",[t._v("HTTP头信息：\n"),a("ul",[a("li",[t._v("Content-Type：application/json")])])])]),t._v(" "),a("p",[t._v("规范要求，对那些可能对服务器数据产生副作用的 HTTP 请求方法，浏览器必须首先使用 "),a("code",[t._v("Method: OPTIONS")]),t._v("发起一个预检请求（preflight request），从而获知服务端是否允许该跨域请求。")]),t._v(" "),a("ul",[a("li",[t._v("预检Options请求/响应\n"),a("ul",[a("li",[t._v("请求\n"),a("ul",[a("li",[a("code",[t._v("Origin")]),a("sup",[t._v("简单/非简单CORS通用")]),t._v("：预检请求或实际请求的源站")]),t._v(" "),a("li",[t._v("Access-Control-Request-Headers：将实际请求所携带的首部字段告诉服务器。")]),t._v(" "),a("li",[t._v("Access-Control-Request-Method：将实际请求所使用的 HTTP 方法告诉服务器。")])])]),t._v(" "),a("li",[t._v("响应\n"),a("ul",[a("li",[a("code",[t._v("Access-Control-Allow-Origin")]),a("sup",[t._v("简单/非简单CORS通用")]),t._v(": 指定了允许访问该资源的外域 URI")]),t._v(" "),a("li",[t._v("Access-Control-Allow-Headers：指明了实际请求中允许携带的首部字段。")]),t._v(" "),a("li",[t._v("Access-Control-Allow-Methods:用于预检请求的响应，指明了实际请求所允许使用的 HTTP 方法。")]),t._v(" "),a("li",[t._v("Access-Control-Max-Age:指定了preflight请求的结果能够被缓存多久。在有效时间内，浏览器无须为同一请求再次发起预检请求。")])])])])]),t._v(" "),a("li",[t._v("正式请求/响应\n"),a("ul",[a("li",[t._v("请求：Origin/Access-Control-Request-Headers/Access-Control-Request-Method")]),t._v(" "),a("li",[t._v("响应：Access-Control-Allow-Origin")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://mdn.mozillademos.org/files/14289/prelight.png",alt:""}})]),t._v(" "),a("blockquote",[a("p",[t._v("大多数浏览器不支持针对于预检请求的重定向。如果一个预检请求发生了重定向，浏览器将报告错误")])]),t._v(" "),a("h2",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),a("ul",[a("li",[t._v("服务端\n"),a("ul",[a("li",[t._v("nginx代理跨域")]),t._v(" "),a("li",[t._v("nodejs代理跨域")]),t._v(" "),a("li",[t._v("websocket")])])]),t._v(" "),a("li",[t._v("浏览器\n"),a("ul",[a("li",[t._v("html5 postMessage")]),t._v(" "),a("li",[t._v("iframe")])])])]),t._v(" "),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),a("ul",[a("li",[t._v("MDN "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cross-Origin Resource Sharing (CORS)"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.w3.org/TR/cors/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS官方规范"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://javascript.ruanyifeng.com/bom/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("CORS通信"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);